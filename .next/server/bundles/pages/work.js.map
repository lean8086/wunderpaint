{"version":3,"file":"bundles/pages/work.js","sources":["webpack:///webpack/bootstrap ae2547bdf706eb102b72","webpack:///components/App.js","webpack:///components/Grid.js","webpack:///components/New.js","webpack:///components/Toolbar.js","webpack:///containers/Grid.js","webpack:///containers/Layer.js","webpack:///containers/Workspace.js","webpack:///firebase.js","webpack:///pages/work.js","webpack:///store.js","webpack:///external \"@babel/runtime/regenerator\"","webpack:///external \"firebase\"","webpack:///external \"next/link\"","webpack:///external \"next/router\"","webpack:///external \"react\"","webpack:///external \"react-redux\"","webpack:///external \"redux\"","webpack:///external \"redux-devtools-extension\"","webpack:///external \"redux-thunk\"","webpack:///external \"shortid\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ae2547bdf706eb102b72","import Toolbar from '../components/Toolbar';\nimport Workspace from '../containers/Workspace';\n// import Toolbox from '../components/Toolbox';\n\nconst App = ({ id, sync, preloaded }) => (\n  <div>\n    <Toolbar />\n    <Workspace sync={sync}/>\n  </div>\n);\n\nexport default App;\n\n\n\n// WEBPACK FOOTER //\n// components/App.js","export default ({ hidden, gridSize, width, height }) => (\n  <div\n    className='Grid Layer'\n    hidden={hidden}\n    style={{\n      backgroundSize: `${gridSize}px ${gridSize}px`,\n      width: `${width}px`,\n      height: `${height}px`,\n    }}\n  />\n);\n\n\n\n// WEBPACK FOOTER //\n// components/Grid.js","import Link from 'next/link';\nimport { generate } from 'shortid';\n\nconst id = generate();\n\nexport default () => (\n  <Link as={`/w/${id}`} href={`/work?id=${id}`}>\n    <a>New</a>\n  </Link>\n);\n\n\n\n// WEBPACK FOOTER //\n// components/New.js","import New from './New';\n// import Zoom from './Zoom';\n// import ToggleGrid from './ToggleGrid';\n// import ColorPicker from './ColorPicker';\n\nconst Toolbar = (props) => (\n  <div>\n    <New />\n  </div>\n);\n// <ColorPicker />\n// <ToggleGrid />\n// <Zoom />\n\nexport default Toolbar;\n\n\n\n// WEBPACK FOOTER //\n// components/Toolbar.js","import { connect } from 'react-redux';\nimport Grid from '../components/Grid';\n\nconst GridContainer = ({ grid, scale, width, height }) => (\n  <Grid\n    hidden={!grid || scale <= 3}\n    gridSize={scale}\n    width={width * scale}\n    height={height * scale}\n  />\n);\n\nconst mapStateToProps = state => ({\n  grid: state.grid,\n  scale: state.scale,\n  width: state.width,\n  height: state.height,\n});\n\nexport default connect(mapStateToProps)(GridContainer);\n\n\n\n// WEBPACK FOOTER //\n// containers/Grid.js","import { Component } from 'react';\nimport { connect } from 'react-redux';\n\nclass LayerContainer extends Component {\n  componentDidMount() {\n    this.ctx = this.canvas.getContext('2d');\n  }\n\n  clear() {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  getImageData() {\n    return this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height).data;\n  }\n\n  putImageData(data) {\n    const { width, height } = this.canvas;\n    for (let y = 0; y < height; y += 1) {\n      for (let x = 0; x < width; x += 1) {\n        const pos = (y * width + x) * 4;\n        const pixel = data.slice(pos, pos + 4);\n        this.ctx.fillStyle = `rgba(${pixel.join(',')})`;\n        this.ctx.fillRect(x, y, 1, 1);\n      }\n    }\n  }\n\n  slowAndSafePutImageData(data) {\n    const { width, height } = this.canvas;\n    for (let y = 0; y < height; y += 1) {\n      for (let x = 0; x < width; x += 1) {\n        const pos = (y * width + x) * 4;\n        const [r, g, b, a] = [\n          data[pos],\n          data[pos + 1],\n          data[pos + 2],\n          data[pos + 3] / 255,\n        ];\n        this.ctx.fillStyle = `rgba(${r},${g},${b},${a})`;\n        this.ctx.fillRect(x, y, 1, 1);\n      }\n    }\n  }\n\n  render() {\n    return (\n      <canvas\n        className='Layer'\n        width={this.props.width}\n        height={this.props.height}\n        style={{ transform: `scale(${this.props.scale})` }}\n        ref={c => this.canvas = c}\n      />\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  scale: state.scale,\n  width: state.width,\n  height: state.height,\n});\n\nexport default connect(mapStateToProps)(LayerContainer);\n\n\n\n// WEBPACK FOOTER //\n// containers/Layer.js","import { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { updateCanvas } from '../store';\nimport Layer from './Layer';\nimport Grid from './Grid';\n\nclass WorkspaceContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isToolExecuting: false,\n    };\n  }\n\n  snapshot() {\n    this.props.sync(this.layer.getImageData());\n    this.timer = setTimeout(() => this.props.sync(), 3 * 1000);\n  }\n\n  handleEvent(actionName, ev) {\n    if (!tools[this.props.tool][actionName]) return;\n    const { tool, color, scale } = this.props;\n    const pageX = ev.pageX || ev.touches[0].pageX || 0;\n    const pageY = ev.pageY || ev.touches[0].pageY || 0;\n\n    // TODO: move to state\n    tools[tool][actionName]({\n      x: Math.round((pageX - this.layer.canvas.offsetLeft + this.element.scrollLeft) / scale - .5),\n      y: Math.round((pageY - this.layer.canvas.offsetTop + this.element.scrollTop) / scale - .5),\n      color,\n      scale,\n      shadowLayer: this.shadowLayer,\n      layer: this.layer,\n    });\n  }\n\n  handleClick(ev) {\n    this.setState({ isToolExecuting: false });\n    this.handleEvent('handleClick', ev);\n  }\n\n  handleMouseDown(ev) {\n    this.setState({ isToolExecuting: true });\n    this.handleEvent('handleMouseDown', ev);\n    if (this.timer) clearTimeout(this.timer);\n  }\n\n  handleMouseUp(ev) {\n    this.setState({ isToolExecuting: false });\n    this.handleEvent('handleMouseUp', ev);\n    this.snapshot();\n  }\n\n  handleMouseMove(ev) {\n    if (this.state.isToolExecuting) {\n      this.handleEvent('handleMouseMove', ev);\n    }\n  }\n\n  render() {\n    return (\n      <div\n        onClick={(ev) => this.handleClick(ev)}\n        onMouseDown={(ev) => this.handleMouseDown(ev)}\n        onMouseUp={(ev) => this.handleMouseUp(ev)}\n        onMouseMove={(ev) => this.handleMouseMove(ev)}\n      >\n        <div className='Canvas'>\n          <Layer ref={l => this.layer = l} />\n          <Layer ref={l => this.shadowLayer = l} />\n          <Grid />\n        </div>\n      </div>\n    );\n  };\n};\n\nconst mapStateToProps = (state) => ({\n  color: state.color,\n  scale: state.scale,\n  tool: state.tool,\n  canvas: state.canvas,\n  width: state.width,\n  height: state.height,\n});\n\nconst mapDispatchToProps = {\n  updateCanvas,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(WorkspaceContainer);\n\n\n\n// WEBPACK FOOTER //\n// containers/Workspace.js","import firebase from 'firebase';\n\nconst config = {\n  apiKey: 'AIzaSyCJnfKVhoBw6aoupX1xhbb0X_w-nGqJpC8',\n  authDomain: 'lodpi-63998.firebaseapp.com',\n  databaseURL: 'https://lodpi-63998.firebaseio.com',\n  // storageBucket: '<BUCKET>.appspot.com',\n};\n\nexport default !firebase.apps.length ? firebase.initializeApp(config) : firebase.app();\n\n\n// WEBPACK FOOTER //\n// firebase.js","import { withRouter } from 'next/router';\nimport firebase from '../firebase';\nimport { Provider } from 'react-redux';\nimport store from '../store';\nimport App from '../components/App';\n\nconst Work = withRouter(({ router, ref, preloaded }) => (\n  <Provider store={store}>\n    <App\n      id={router.query.id}\n      sync={() => ref.set(attrs)}\n      preloaded={preloaded}\n    />\n  </Provider>\n));\n\nWork.getInitialProps = async ({ query }) => {\n  let preloaded;\n  const ref = await firebase.database().ref(`works/${query.id}`);\n  await ref.once('value', snapshot => preloaded = snapshot.val());\n  return { ref, preloaded };\n};\n\nexport default Work;\n\n\n\n// WEBPACK FOOTER //\n// pages/work.js","import { createStore, applyMiddleware } from 'redux';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport thunkMiddleware from 'redux-thunk';\n\nconst initialState = {\n  grid: true,\n  scale: 10,\n  tool: 'pencil',\n  color: '#000',\n  canvas: [],\n  width: 32,\n  height: 32,\n};\n\n/**\n * Reducers\n */\nexport const reducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'TOGGLE_GRID':\n      return { ...state, grid: !state.grid };\n    case 'INCREASE_SCALE':\n      return { ...state, scale: state.scale += 1 };\n    case 'DECREASE_SCALE':\n      return { ...state, scale: state.scale -= 1 };\n    case 'SELECT_TOOL':\n      return { ...state, tool: action.tool };\n    case 'SELECT_COLOR':\n      return { ...state, color: action.color };\n    case 'UPDATE_CANVAS':\n      return { ...state, canvas: action.data };\n    default:\n      return state;\n  }\n};\n\n/**\n * Actions\n */\nexport const toggleGrid = () => dispatch => (\n  dispatch({ type: 'TOGGLE_GRID' })\n);\n\nexport const increaseScale = () => dispatch => (\n  dispatch({ type: 'INCREASE_SCALE' })\n);\n\nexport const decreaseScale = () => dispatch => (\n  dispatch({ type: 'DECREASE_SCALE' })\n);\n\nexport const selectTool = (tool) => dispatch => (\n  dispatch({ type: 'SELECT_TOOL', tool })\n);\n\nexport const selectColor = (color) => dispatch => (\n  dispatch({ type: 'SELECT_COLOR', color })\n);\n\nexport const updateCanvas = (data) => dispatch => (\n  dispatch({ type: 'UPDATE_CANVAS', data })\n);\n\n/**\n * Init\n */\nexport default createStore(\n  reducer,\n  initialState,\n  composeWithDevTools(applyMiddleware(thunkMiddleware)),\n);\n\n\n\n// WEBPACK FOOTER //\n// store.js","module.exports = require(\"@babel/runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@babel/runtime/regenerator\"\n// module id = @babel/runtime/regenerator\n// module chunks = 3","module.exports = require(\"firebase\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"firebase\"\n// module id = firebase\n// module chunks = 3","module.exports = require(\"next/link\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"next/link\"\n// module id = next/link\n// module chunks = 3","module.exports = require(\"next/router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"next/router\"\n// module id = next/router\n// module chunks = 3","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = react\n// module chunks = 3","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = react-redux\n// module chunks = 3","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = redux\n// module chunks = 3","module.exports = require(\"redux-devtools-extension\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-devtools-extension\"\n// module id = redux-devtools-extension\n// module chunks = 3","module.exports = require(\"redux-thunk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-thunk\"\n// module id = redux-thunk\n// module chunks = 3","module.exports = require(\"shortid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shortid\"\n// module id = shortid\n// module chunks = 3"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACnEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AACA;AAMA;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAHA;AAAA;AAAA;AAAA;AAAA;AADA;;;;;;;;;;;;;;;;ACAA;AACA;AAEA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;;;;;;;;;;;;;ACLA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAMA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;ACdA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAQA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AACA;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBA;AACA;AACA;AACA;;;;;;;;;;;;;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AACA;AA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","sourceRoot":""}